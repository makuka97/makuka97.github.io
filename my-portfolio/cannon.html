<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannon Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-wrapper {
            max-width: 900px;
            width: 100%;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #6ab4ff;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #6ab4ff;
            border-radius: 4px;
        }

        .back-link:hover {
            background: rgba(106, 180, 255, 0.2);
        }

        #terminal {
            background: #000;
            border: 2px solid #00ff00;
            padding: 20px;
            border-radius: 8px;
            min-height: 500px;
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .terminal-line {
            margin: 4px 0;
            white-space: pre;
            font-size: 14px;
        }

        .input-area {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: #001a00;
            border: 2px solid #00ff00;
            border-radius: 4px;
        }

        .input-area.active {
            display: block;
        }

        .input-prompt {
            margin-bottom: 10px;
            color: #00ff00;
            font-weight: bold;
        }

        #userInput {
            width: 100%;
            padding: 10px;
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #userInput:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .submit-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: #00ff00;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
        }

        .submit-btn:hover {
            background: #00cc00;
        }

        .hint {
            margin-top: 10px;
            color: #888;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <a href="index.html" class="back-link">← Back to Portfolio</a>
        
        <div id="terminal"></div>
        
        <div class="input-area" id="inputArea">
            <div class="input-prompt" id="inputPrompt">Enter value:</div>
            <input type="text" id="userInput" placeholder="Type here...">
            <button class="submit-btn" onclick="submitInput()">Submit (Enter)</button>
            <div class="hint">Press Enter to submit</div>
        </div>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const inputArea = document.getElementById('inputArea');
        const inputPrompt = document.getElementById('inputPrompt');
        const userInput = document.getElementById('userInput');
        
        let inputCallback = null;
        let gameState = 'title';
        let attempt = 1;
        const targetDistance = 200.0;
        const tolerance = 3.0;
        const G = 9.8;

        function print(text) {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.textContent = text;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function clearTerminal() {
            terminal.innerHTML = '';
        }

        function showInput(prompt, callback) {
            inputPrompt.textContent = prompt;
            inputArea.classList.add('active');
            userInput.value = '';
            userInput.focus();
            inputCallback = callback;
        }

        function hideInput() {
            inputArea.classList.remove('active');
            inputCallback = null;
        }

        function submitInput() {
            const value = userInput.value.trim();
            if (value && inputCallback) {
                print('> ' + value);
                const callback = inputCallback;
                hideInput();
                callback(value);
            }
        }

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitInput();
            }
        });

        function computeX(v, angleRad, t) {
            return v * Math.cos(angleRad) * t;
        }

        function computeY(v, angleRad, t) {
            return v * Math.sin(angleRad) * t - 0.5 * G * t * t;
        }

        function drawField(trail, targetDist, maxRange, maxHeight) {
            const WIDTH = 80;
            const HEIGHT = 25;
            let field = '';

            for (let row = HEIGHT; row >= 0; row--) {
                let line = '';
                for (let col = 0; col <= WIDTH; col++) {
                    const worldX = col / WIDTH * maxRange;
                    const worldY = row / HEIGHT * maxHeight;
                    
                    let drawn = false;

                    // Check if projectile is at this position
                    for (const p of trail) {
                        if (Math.abs(p.x - worldX) < maxRange / WIDTH / 2 &&
                            Math.abs(p.y - worldY) < maxHeight / HEIGHT / 2) {
                            line += '*';
                            drawn = true;
                            break;
                        }
                    }

                    if (!drawn) {
                        if (col === 0 && row === 0)
                            line += 'C'; // cannon
                        else if (Math.abs(worldX - targetDist) < maxRange / WIDTH / 2 && row <= 2)
                            line += 'X'; // target
                        else if (row === 0)
                            line += '_'; // ground
                        else
                            line += ' ';
                    }
                }
                field += line + '\n';
            }
            
            clearTerminal();
            print(field);
        }

        async function simulateShot(angle, velocity) {
            const angleRad = angle * Math.PI / 180;
            let t = 0;
            const TIME_STEP = 0.1;
            
            const range = (velocity * velocity * Math.sin(2 * angleRad)) / G;
            const maxHeight = (velocity * velocity * Math.pow(Math.sin(angleRad), 2)) / (2 * G);
            const displayRange = Math.max(range, targetDistance * 1.3);
            
            const trail = [];

            return new Promise((resolve) => {
                const interval = setInterval(() => {
                    const x = computeX(velocity, angleRad, t);
                    let y = computeY(velocity, angleRad, t);
                    if (y < 0) y = 0;

                    trail.push({x, y});
                    drawField(trail, targetDistance, displayRange, maxHeight * 2.5);

                    if (y <= 0 && t > 0.2) {
                        clearInterval(interval);
                        resolve(x);
                    }

                    t += TIME_STEP;
                }, 50);
            });
        }

        function showTitle() {
            clearTerminal();
            print('  ____    _    _   _  _   _   ___   _   _ ');
            print(' / ___|  / \\  | \\ | || \\ | | / _ \\ | \\ | |');
            print('| |     / _ \\ |  \\| ||  \\| || | | ||  \\| |');
            print('| |___ / ___ \\| |\\  || |\\  || |_| || |\\  |');
            print(' \\____/_/   \\_\\_| \\_||_| \\_| \\___/ |_| \\_|');
            print('');
            print('');
            print('   WRITTEN BY MICAJAH NORDYKE');
            print('  INSPIRED BY CS161 ASSIGNMENT 2');
            print('----------------------------------------');
            print('');
            
            showInput('Press Enter to start!', () => {
                startGame();
            });
        }

        function startGame() {
            clearTerminal();
            print('=== CANNON ===');
            print('Try to hit the target (marked \'X\') at 200 meters!');
            print('');
            nextAttempt();
        }

        function nextAttempt() {
            print('');
            print('Attempt #' + attempt);
            
            showInput('Enter angle (degrees):', (angleStr) => {
                const angle = parseFloat(angleStr);
                if (isNaN(angle)) {
                    print('Invalid angle! Try again.');
                    nextAttempt();
                    return;
                }

                showInput('Enter velocity (m/s):', async (velocityStr) => {
                    const velocity = parseFloat(velocityStr);
                    if (isNaN(velocity)) {
                        print('Invalid velocity! Try again.');
                        nextAttempt();
                        return;
                    }

                    print('');
                    print('Firing...');
                    
                    const landing = await simulateShot(angle, velocity);
                    
                    print('');
                    print('Projectile landed at ' + landing.toFixed(1) + ' meters.');
                    
                    if (Math.abs(landing - targetDistance) <= tolerance) {
                        print('');
                        print(' YOU HIT THE TARGET! ');
                        print('');
                        print('Game over — thanks for playing!');
                        print('');
                        showInput('Play again? (yes/no):', (answer) => {
                            if (answer.toLowerCase() === 'yes' || answer.toLowerCase() === 'y') {
                                attempt = 1;
                                startGame();
                            } else {
                                clearTerminal();
                                print('Thanks for playing!');
                            }
                        });
                    } else if (landing < targetDistance) {
                        print('Too short!');
                        attempt++;
                        nextAttempt();
                    } else {
                        print('Too far!');
                        attempt++;
                        nextAttempt();
                    }
                });
            });
        }

        // Start the game
        showTitle();
    </script>
</body>
</html>

